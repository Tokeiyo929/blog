---
title: çº¢ç‚¹ç³»ç»Ÿä½¿ç”¨æ–‡æ¡£
category: [ä»£ç è§£æ]
date: 2025-12-03
cover_image: https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&w=1170&q=80
excerpt: æœ¬æ–‡è®¨è®ºäº† prefab ä¸­ç‰¹æ•ˆçš„å¤„ç†æ–¹å¼ï¼Œæ—¨åœ¨è§£å†³ç‰¹æ•ˆåµŒå…¥ prefab å¯¼è‡´çš„èµ„æºå¸è½½å›°éš¾å’Œçº¹ç†èµ„æºå†—ä½™é—®é¢˜ï¼ŒåŒæ—¶ç»Ÿä¸€åˆ¶ä½œæ–¹å¼å¹¶å‡å°‘ç¨‹åºæ¥å…¥ã€‚
tags: [ç¾æœ¯, ç¨‹åº]
---

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿä»‹ç»](#ç³»ç»Ÿä»‹ç»)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
  - [UIç»„ä»¶ä½¿ç”¨](#uiç»„ä»¶ä½¿ç”¨)
  - [æ³¨å†Œå™¨å®ç°](#æ³¨å†Œå™¨å®ç°)
  - [åŠ¨æ€çº¢ç‚¹æ³¨å†Œ](#åŠ¨æ€çº¢ç‚¹æ³¨å†Œ)
  - [æ‰¹é‡åˆ·æ–°](#æ‰¹é‡åˆ·æ–°)
- [APIæ–‡æ¡£](#apiæ–‡æ¡£)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ¯ ç³»ç»Ÿä»‹ç»

çº¢ç‚¹ç³»ç»Ÿæ˜¯ä¸€ä¸ªç»Ÿä¸€ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ¸¸æˆå†…é€šçŸ¥æç¤ºç³»ç»Ÿã€‚é€šè¿‡æ ‘å½¢ç»“æ„ç®¡ç†çº¢ç‚¹èŠ‚ç‚¹ï¼Œæ”¯æŒé™æ€é¢„æ³¨å†Œå’ŒåŠ¨æ€è¿è¡Œæ—¶æ³¨å†Œï¼Œæä¾›çµæ´»çš„åˆ·æ–°æœºåˆ¶å’Œæ‰¹é‡æ“ä½œèƒ½åŠ›ã€‚

### è®¾è®¡ç›®æ ‡

- âœ… **æ¨¡å—åŒ–è®¾è®¡** - æ¯ä¸ªç³»ç»Ÿç‹¬ç«‹ç®¡ç†è‡ªå·±çš„çº¢ç‚¹é€»è¾‘ï¼Œé¿å…ä»£ç å†²çª
- âœ… **é¢„æ³¨å†Œæœºåˆ¶** - çˆ¶èŠ‚ç‚¹å¯ä»¥åœ¨å­ç•Œé¢æœªæ‰“å¼€æ—¶è¯†åˆ«åˆ°å­ç•Œé¢çš„çº¢ç‚¹çŠ¶æ€
- âœ… **åŠ¨æ€æ‰©å±•** - æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œå’Œæ³¨é”€çº¢ç‚¹èŠ‚ç‚¹
- âœ… **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡æ ‡è®°è„æ•°æ®å’Œæ‰¹é‡åˆ·æ–°ï¼Œæå‡æ€§èƒ½
- âœ… **ç±»å‹å®‰å…¨** - åŸºäºæšä¸¾ç±»å‹ï¼Œé¿å…å­—ç¬¦ä¸²æ‹¼å†™é”™è¯¯

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. æ¨¡å—åŒ–æ³¨å†Œæœºåˆ¶
- æ¯ä¸ªç³»ç»Ÿé€šè¿‡å®ç° `IRedDotRegistrar` æ¥å£ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„çº¢ç‚¹
- è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæ‰€æœ‰æ¨¡å—ï¼Œæ— éœ€é…ç½®æ–‡ä»¶
- æ”¯æŒæ¨¡å—ä¼˜å…ˆçº§æ§åˆ¶

### 2. é¢„æ³¨å†Œæ”¯æŒ
- æ¸¸æˆå¯åŠ¨æ—¶é¢„æ³¨å†Œæ‰€æœ‰çº¢ç‚¹èŠ‚ç‚¹å’Œå¤„ç†å™¨
- çˆ¶èŠ‚ç‚¹å¯ä»¥åœ¨å­ç•Œé¢æœªæ‰“å¼€æ—¶æ­£ç¡®æ˜¾ç¤ºçº¢ç‚¹çŠ¶æ€
- é¿å…ç¡¬ç¼–ç çš„çˆ¶å­å…³ç³»ç®¡ç†

### 3. åŠ¨æ€çº¢ç‚¹æ”¯æŒ
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ³¨å†Œ/æ³¨é”€çº¢ç‚¹èŠ‚ç‚¹ï¼ˆå¦‚æ–°è·å¾—çš„è‹±é›„ï¼‰
- æ”¯æŒå¤šå…¥å£çº¢ç‚¹ï¼ˆä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥å±äºå¤šä¸ªçˆ¶èŠ‚ç‚¹ï¼‰
- æ”¯æŒå®ä½“å®ä¾‹çº¢ç‚¹ï¼ˆè‹±é›„IDã€ä»»åŠ¡IDç­‰ï¼‰

### 4. æ™ºèƒ½åˆ·æ–°æœºåˆ¶
- æ”¯æŒå•ä¸ªçº¢ç‚¹åˆ·æ–°
- æ”¯æŒæ‰¹é‡æ ‡è®°è„æ•°æ®å¹¶é€‰æ‹©æ€§åˆ·æ–°
- æ”¯æŒæŒ‰ç±»å‹æˆ–çˆ¶èŠ‚ç‚¹æ‰¹é‡åˆ·æ–°
- è‡ªåŠ¨å‘ä¸Šå†’æ³¡èšåˆçˆ¶èŠ‚ç‚¹çŠ¶æ€

### 5. ç”Ÿå‘½å‘¨æœŸç®¡ç†
- è‡ªåŠ¨å¤„ç†åˆ‡å·/é‡ç™»åœºæ™¯
- ç»Ÿä¸€çš„äº‹ä»¶è®¢é˜…/é€€è®¢æœºåˆ¶
- å†…å­˜å®‰å…¨ï¼Œé¿å…æ³„æ¼

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–çº¢ç‚¹ç³»ç»Ÿ

åœ¨æ¸¸æˆå¯åŠ¨æ—¶åˆå§‹åŒ–ï¼š

```csharp
RedDotManager.Instance.Init();
```

### 2. åœ¨UIä¸ŠæŒ‚è½½çº¢ç‚¹ç»„ä»¶
å·²å®ç°é¢„åˆ¶ä½“`RedDotComponent.prefab`ï¼š

### 3. åˆ›å»ºæ³¨å†Œå™¨

```csharp
public class MySystemRedDotRegistrar : IRedDotRegistrar
{
    public RedDotDefine ModuleName => RedDotDefine.MySystemRoot;

    public void RegisterRedDots(RedDotRegistry registry)
    {
        // æ³¨å†Œé™æ€çº¢ç‚¹æ ‘ç»“æ„
        registry.RegisterNode(RedDotDefine.MySystemRoot, RedDotDefine.None);
        registry.RegisterNode(RedDotDefine.MySystem_SubPanel, RedDotDefine.MySystemRoot);
        
        // æ³¨å†Œå¤„ç†å™¨
        registry.RegisterHandler(RedDotDefine.MySystem_SubPanel, node =>
        {
            node.isActive = CheckMySystemCondition();
            node.count = node.isActive ? 1 : 0;
        });
    }

    public void OnStart(RedDotRegistry registry)
    {
        // è®¢é˜…äº‹ä»¶ï¼Œå¤„ç†åŠ¨æ€çº¢ç‚¹
    }

    public void OnStop(RedDotRegistry registry)
    {
        // å–æ¶ˆè®¢é˜…äº‹ä»¶
    }
}
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
RedDotManager (å•ä¾‹)
    â”œâ”€â”€ RedDotRegistry (æ³¨å†Œè¡¨)
    â”‚   â”œâ”€â”€ nodeRegistry (èŠ‚ç‚¹ä¿¡æ¯)
    â”‚   â”œâ”€â”€ childrenRegistry (çˆ¶å­å…³ç³»)
    â”‚   â””â”€â”€ handlerRegistry (å¤„ç†å™¨)
    â””â”€â”€ IRedDotRegistrar[] (å„æ¨¡å—æ³¨å†Œå™¨)
        â”œâ”€â”€ RegisterRedDots() (é™æ€æ ‘æ³¨å†Œ)
        â”œâ”€â”€ OnStart() (è®¢é˜…äº‹ä»¶+åŠ¨æ€æ³¨å†Œ)
        â””â”€â”€ OnStop() (é€€è®¢äº‹ä»¶)

RedDotComponent (UIç»„ä»¶)
    â””â”€â”€ è‡ªåŠ¨å“åº”çº¢ç‚¹çŠ¶æ€å˜åŒ–
```

### æ•°æ®æµ

```
æ•°æ®å˜æ›´äº‹ä»¶
    â†“
Registrar è®¢é˜…çš„äº‹ä»¶å›è°ƒ
    â†“
è°ƒç”¨ RedDotManager.RefreshRedDot()
    â†“
RedDotRegistry åˆ·æ–°èŠ‚ç‚¹çŠ¶æ€
    â†“
å‘ä¸Šå†’æ³¡åˆ·æ–°çˆ¶èŠ‚ç‚¹
    â†“
å¹¿æ’­çŠ¶æ€å˜åŒ–äº‹ä»¶
    â†“
RedDotComponent è‡ªåŠ¨æ›´æ–°UI
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### UIç»„ä»¶ä½¿ç”¨

#### åŸºç¡€ä½¿ç”¨

1. **åœ¨Prefabä¸ŠæŒ‚è½½ç»„ä»¶**
   - åœ¨Inspectorä¸­é€‰æ‹©è¦æ˜¾ç¤ºçš„çº¢ç‚¹ç±»å‹ï¼ˆæ”¯æŒåˆ†ç±»é€‰æ‹©å™¨ï¼‰
   - é…ç½®IDï¼ˆå¦‚æœæ˜¯åŠ¨æ€IDï¼Œä¿æŒæšä¸¾Noneï¼Œåœ¨å®ä¾‹åŒ–æ—¶é€šè¿‡ä»£ç è®¾ç½®ï¼‰
   - ç³»ç»Ÿä¼šè‡ªåŠ¨å“åº”çº¢ç‚¹çŠ¶æ€å˜åŒ–

2. **ä»£ç åŠ¨æ€è®¾ç½®**
   ```csharp
   var redDot = GetComponent<RedDotComponent>();
   
   // é™æ€çº¢ç‚¹
   redDot.RedDotKey = RedDotKey.Of(RedDotDefine.MainViewRoot);
   
   // åŠ¨æ€çº¢ç‚¹ï¼ˆå¦‚è‹±é›„å¡ç‰‡ï¼‰
   redDot.RedDotKey = RedDotKey.Of(RedDotDefine.Hero_CardUpgradeable, heroId);
   ```

#### Inspectoré…ç½®

- **åˆ†ç±»é€‰æ‹©å™¨**ï¼šæŒ‰ä¸‹åˆ’çº¿è‡ªåŠ¨åˆ†ç»„ï¼Œé€‰æ‹©åˆ†ç±»åå†é€‰æ‹©å…·ä½“ç±»å‹
- **æ— ä¸‹åˆ’çº¿çš„æšä¸¾**ï¼šç›´æ¥åœ¨ä¸€çº§ä¸‹æ‹‰ä¸­é€‰æ‹©ï¼Œæ— éœ€äºŒçº§é€‰æ‹©
- **IDè¾“å…¥æ¡†**ï¼šç”¨äºå®ä½“å®ä¾‹çº¢ç‚¹ï¼ˆå¦‚è‹±é›„IDã€ä»»åŠ¡IDç­‰ï¼‰

### æ³¨å†Œå™¨å®ç°

#### é™æ€çº¢ç‚¹æ ‘æ³¨å†Œ

åœ¨ `RegisterRedDots()` ä¸­æ³¨å†Œé™æ€çš„çº¢ç‚¹æ ‘ç»“æ„ï¼š

```csharp
public void RegisterRedDots(RedDotRegistry registry)
{
    // æ³¨å†Œçº¢ç‚¹æ ‘ç»“æ„
    registry.RegisterNode(RedDotDefine.HeroRoot, RedDotDefine.None);
    registry.RegisterNode(RedDotDefine.Hero_AnyUpgradeable, RedDotDefine.HeroRoot);
    registry.RegisterNode(RedDotDefine.Hero_AnyNew, RedDotDefine.HeroRoot);
    
    // æ³¨å†Œå¤„ç†å™¨
    registry.RegisterHandler(RedDotDefine.Hero_AnyUpgradeable, node =>
    {
        node.isActive = HasAnyHeroCanUpgrade();
        node.count = GetUpgradeableHeroCount();
    });
}
```

#### åŠ¨æ€çº¢ç‚¹æ³¨å†Œ

åœ¨ `OnStart()` ä¸­è®¢é˜…äº‹ä»¶ï¼Œå¤„ç†åŠ¨æ€çº¢ç‚¹ï¼š

```csharp
public void OnStart(RedDotRegistry registry)
{
    // è®¢é˜…è‹±é›„è·å¾—äº‹ä»¶
    PlayerData.OnHeroAdded += heroId =>
    {
        var parentKey = RedDotKey.Of(RedDotDefine.Hero_AnyUpgradeable);
        var childKey = RedDotKey.Of(RedDotDefine.Hero_CardUpgradeable, heroId);
        
        // æ³¨å†ŒèŠ‚ç‚¹
        registry.RegisterNode(childKey, parentKey);
        
        // æ³¨å†Œå¤„ç†å™¨
        registry.RegisterHandler(childKey, node =>
        {
            node.isActive = CanHeroUpgrade(heroId);
            node.count = node.isActive ? 1 : 0;
        });
        
        // åˆ·æ–°çº¢ç‚¹
        RedDotManager.Instance.RefreshRedDot(childKey);
    };
    
    // è®¢é˜…è‹±é›„åˆ é™¤äº‹ä»¶
    PlayerData.OnHeroRemoved += heroId =>
    {
        var childKey = RedDotKey.Of(RedDotDefine.Hero_CardUpgradeable, heroId);
        registry.UnregisterNode(childKey);
    };
    
    // è®¢é˜…æ•°æ®å˜æ›´äº‹ä»¶
    PlayerData.OnHeroDataChanged += heroId =>
    {
        var childKey = RedDotKey.Of(RedDotDefine.Hero_CardUpgradeable, heroId);
        RedDotManager.Instance.RefreshRedDot(childKey);
    };
}

public void OnStop(RedDotRegistry registry)
{
    // å–æ¶ˆè®¢é˜…æ‰€æœ‰äº‹ä»¶
    PlayerData.OnHeroAdded -= ...;
    PlayerData.OnHeroRemoved -= ...;
    PlayerData.OnHeroDataChanged -= ...;
}
```

#### å¤šå…¥å£çº¢ç‚¹

æ”¯æŒä¸€ä¸ªèŠ‚ç‚¹å±äºå¤šä¸ªçˆ¶èŠ‚ç‚¹ï¼š

```csharp
// ä»»åŠ¡çº¢ç‚¹åŒæ—¶å±äºä¸»ç•Œé¢å’Œä»»åŠ¡ç•Œé¢
var taskKey = RedDotKey.Of(RedDotDefine.Task_Daily);
var parents = new RedDotKey[]
{
    RedDotKey.Of(RedDotDefine.MainViewRoot),
    RedDotKey.Of(RedDotDefine.TaskPanel)
};
registry.RegisterNodeWithMultipleParents(taskKey, parents);
```

### åŠ¨æ€çº¢ç‚¹æ³¨å†Œ

#### è¿è¡Œæ—¶æ³¨å†Œæ–°è‹±é›„çº¢ç‚¹

```csharp
public void OnGetNewHero(int heroId)
{
    var parentKey = RedDotKey.Of(RedDotDefine.Hero_AnyUpgradeable);
    var childKey = RedDotKey.Of(RedDotDefine.Hero_CardUpgradeable, heroId);
    
    // æ³¨å†ŒèŠ‚ç‚¹
    registry.RegisterNode(childKey, parentKey);
    
    // æ³¨å†Œå¤„ç†å™¨
    registry.RegisterHandler(childKey, node =>
    {
        node.isActive = CanHeroUpgrade(heroId);
        node.count = node.isActive ? 1 : 0;
    });
    
    // åˆ·æ–°çº¢ç‚¹
    RedDotManager.Instance.RefreshRedDot(childKey);
}
```

### æ‰¹é‡åˆ·æ–°

#### åœºæ™¯ï¼šè·å¾—å‡çº§ææ–™ååˆ·æ–°æ‰€æœ‰è‹±é›„çº¢ç‚¹

```csharp
public void OnGetUpgradeMaterial()
{
    // æ–¹æ¡ˆ1ï¼šæŒ‰çˆ¶èŠ‚ç‚¹æ ‡è®°æ‰€æœ‰å­èŠ‚ç‚¹ä¸ºè„
    var parentKey = RedDotKey.Of(RedDotDefine.Hero_AnyUpgradeable);
    var allDirtyNodes = RedDotManager.Instance.MarkChildrenAsDirty(parentKey);
    
    // æ–¹æ¡ˆ2ï¼šæŒ‰ç±»å‹æ ‡è®°æ‰€æœ‰å®ä¾‹èŠ‚ç‚¹ä¸ºè„ï¼ˆæ›´ç²¾ç¡®ï¼‰
    var heroCardNodes = RedDotManager.Instance.MarkSameTypeAsDirty(RedDotDefine.Hero_CardUpgradeable);
    
    // æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šåˆ·æ–°å“ªäº›èŠ‚ç‚¹
    // ä¾‹å¦‚ï¼šåªåˆ·æ–°å½“å‰ç•Œé¢å¯è§çš„è‹±é›„ï¼Œé¿å…ä¸å¿…è¦çš„è®¡ç®—
    var visibleHeroIds = GetVisibleHeroIds();
    var nodesToRefresh = heroCardNodes
        .Where(node => visibleHeroIds.Contains(node.id1))
        .ToList();
    
    // æ‰¹é‡åˆ·æ–°
    if (nodesToRefresh.Count > 0)
    {
        RedDotManager.Instance.RefreshRedDots(nodesToRefresh);
    }
}
```

#### æ ‡è®°è„æ•°æ®çš„æ–¹æ³•

1. **`MarkChildrenAsDirty(RedDotKey parentKey)`**
   - å°†æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼ˆé€’å½’ï¼‰è®¾ç½®ä¸ºè„
   - é€‚ç”¨äºéœ€è¦åˆ·æ–°æŸä¸ªçˆ¶èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹

2. **`MarkSameTypeAsDirty(RedDotDefine type)`**
   - å°†æŒ‡å®šç±»å‹çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆç±»å‹ç›¸åŒä½†IDä¸åŒï¼‰è®¾ç½®ä¸ºè„
   - é€‚ç”¨äºéœ€è¦åˆ·æ–°åŒä¸€ç±»å‹çš„æ‰€æœ‰å®ä¾‹èŠ‚ç‚¹

---

## ğŸ“š APIæ–‡æ¡£

### RedDotManager

#### åˆå§‹åŒ–æ–¹æ³•

```csharp
// åˆå§‹åŒ–çº¢ç‚¹ç³»ç»Ÿï¼ˆé¦–æ¬¡å¯åŠ¨æ—¶è°ƒç”¨ï¼‰
void Init()

// æ¸…ç†çº¢ç‚¹ç³»ç»Ÿï¼ˆReloadingæ—¶è°ƒç”¨ï¼‰
void Cleanup()
```

#### æŸ¥è¯¢æ–¹æ³•

```csharp
// æ£€æŸ¥çº¢ç‚¹æ•°æ®æ˜¯å¦å¯ç”¨
bool CheckRedDotDataIsAvailable(RedDotKey redDotKey)

// è·å–çº¢ç‚¹çŠ¶æ€
bool GetRedDotStatus(RedDotKey redDotKey)
```

#### åˆ·æ–°æ–¹æ³•

```csharp
// åˆ·æ–°æŒ‡å®šçº¢ç‚¹çŠ¶æ€
void RefreshRedDot(RedDotKey redDotKey)

// æ‰¹é‡åˆ·æ–°çº¢ç‚¹çŠ¶æ€
void RefreshRedDots(List<RedDotKey> redDotKeys)
```

#### æ‰¹é‡æ ‡è®°æ–¹æ³•

```csharp
// å°†æŒ‡å®šèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹è®¾ç½®ä¸ºè„
List<RedDotKey> MarkChildrenAsDirty(RedDotKey parentKey)

// å°†æŒ‡å®šç±»å‹çš„æ‰€æœ‰èŠ‚ç‚¹è®¾ç½®ä¸ºè„
List<RedDotKey> MarkSameTypeAsDirty(RedDotDefine type)
```

### RedDotComponent

#### å±æ€§

```csharp
// çº¢ç‚¹é”®å€¼ï¼ˆå¯åœ¨Inspectoræˆ–ä»£ç ä¸­è®¾ç½®ï¼‰
RedDotKey RedDotKey { get; set; }
```

#### æ–¹æ³•

```csharp
// åˆ·æ–°çº¢ç‚¹æ˜¾ç¤ºçŠ¶æ€
void RefreshRedDotStatus()

// æ˜¾ç¤ºçº¢ç‚¹
void Show()

// éšè—çº¢ç‚¹
void Hide()

// éšè—çº¢ç‚¹æ•°é‡æ–‡å­—
void HideText()
```

### RedDotRegistry

#### æ³¨å†Œæ–¹æ³•

```csharp
// æ³¨å†ŒèŠ‚ç‚¹ï¼ˆå•ä¸ªçˆ¶èŠ‚ç‚¹ï¼‰
void RegisterNode(RedDotKey nodeName, RedDotKey parentName)
void RegisterNode(RedDotDefine nodeName, RedDotDefine parentName)

// æ³¨å†ŒèŠ‚ç‚¹ï¼ˆå¤šä¸ªçˆ¶èŠ‚ç‚¹ï¼‰
void RegisterNodeWithMultipleParents(RedDotKey nodeName, RedDotKey[] parentNames)

// æ³¨å†Œå¤„ç†å™¨
void RegisterHandler(RedDotKey nodeName, Action<RedDotNodeInfo> handler)
void RegisterHandler(RedDotDefine nodeName, Action<RedDotNodeInfo> handler)
```

#### æ³¨é”€æ–¹æ³•

```csharp
// æ³¨é”€èŠ‚ç‚¹
void UnregisterNode(RedDotKey nodeName)
void UnregisterNode(RedDotDefine nodeName)

// æ³¨é”€å¤„ç†å™¨
void UnregisterHandler(RedDotKey nodeName)
void UnregisterHandler(RedDotDefine nodeName)
```

### RedDotKey

#### åˆ›å»ºæ–¹æ³•

```csharp
// åˆ›å»ºé™æ€çº¢ç‚¹é”®å€¼ï¼ˆæ— IDï¼‰
RedDotKey.Of(RedDotDefine type)

// åˆ›å»ºå®ä¾‹çº¢ç‚¹é”®å€¼ï¼ˆæœ‰IDï¼‰
RedDotKey.Of(RedDotDefine type, int id1, int id2 = 0)
```

#### å±æ€§

```csharp
RedDotDefine type;  // çº¢ç‚¹ç±»å‹
int id1;           // ä¸»IDï¼ˆå¦‚è‹±é›„IDï¼‰
int id2;           // å¯é€‰IDï¼ˆå¦‚æ§½ä½ã€å¤©æ•°ç­‰ï¼‰
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ¨¡å—åŒ–å¼€å‘

âœ… **æ¨è**ï¼šæ¯ä¸ªç³»ç»Ÿå®ç°è‡ªå·±çš„ `IRedDotRegistrar`
```csharp
public class HeroRedDotRegistrar : IRedDotRegistrar { ... }
public class TaskRedDotRegistrar : IRedDotRegistrar { ... }
```

âŒ **ä¸æ¨è**ï¼šæŠŠæ‰€æœ‰çº¢ç‚¹é€»è¾‘å†™åœ¨ä¸€ä¸ªåœ°æ–¹
```csharp
// é¿å…è¿™æ ·åš
public class AllRedDotRegistrar : IRedDotRegistrar { ... } // åŒ…å«äº†æ‰€æœ‰ç³»ç»Ÿçš„é€»è¾‘
```

### 2. äº‹ä»¶è®¢é˜…ä½ç½®

âœ… **æ¨è**ï¼šåœ¨ `OnStart()` ä¸­ç»Ÿä¸€è®¢é˜…äº‹ä»¶
```csharp
public void OnStart(RedDotRegistry registry)
{
    PlayerData.OnHeroAdded += OnHeroAdded;
    PlayerData.OnHeroDataChanged += OnHeroDataChanged;
}

public void OnStop(RedDotRegistry registry)
{
    PlayerData.OnHeroAdded -= OnHeroAdded;
    PlayerData.OnHeroDataChanged -= OnHeroDataChanged;
}
```

âŒ **ä¸æ¨è**ï¼šåœ¨ä¸šåŠ¡ä»£ç ä¸­æ•£è½è®¢é˜…
```csharp
// é¿å…åœ¨UIä»£ç ä¸­ç›´æ¥è®¢é˜…
public class UIHeroPanel : MonoBehaviour
{
    void Start()
    {
        PlayerData.OnHeroAdded += ...; // ä¸è¦è¿™æ ·åš
    }
}
```

### 3. æ‰¹é‡åˆ·æ–°ä¼˜åŒ–

âœ… **æ¨è**ï¼šå…ˆæ ‡è®°è„æ•°æ®ï¼Œå†é€‰æ‹©æ€§åˆ·æ–°
```csharp
// æ ‡è®°æ‰€æœ‰ä¸ºè„
var dirtyNodes = RedDotManager.Instance.MarkSameTypeAsDirty(RedDotDefine.Hero_CardUpgradeable);

// åªåˆ·æ–°å¯è§çš„
var visibleNodes = dirtyNodes.Where(node => IsVisible(node.id1)).ToList();
RedDotManager.Instance.RefreshRedDots(visibleNodes);
```

âŒ **ä¸æ¨è**ï¼šæ— å·®åˆ«åˆ·æ–°æ‰€æœ‰èŠ‚ç‚¹
```csharp
// é¿å…è¿™æ ·åš
foreach (var hero in allHeroes)
{
    RedDotManager.Instance.RefreshRedDot(...); // ä¼šåˆ·æ–°ä¸å¯è§çš„èŠ‚ç‚¹ï¼Œæµªè´¹æ€§èƒ½
}
```

### 4. çº¢ç‚¹å¤„ç†å™¨é€»è¾‘

âœ… **æ¨è**ï¼šå¤„ç†å™¨é€»è¾‘ç®€å•é«˜æ•ˆ
```csharp
registry.RegisterHandler(RedDotDefine.Hero_Upgradeable, node =>
{
    // ç®€å•å¿«é€Ÿçš„é€»è¾‘
    node.isActive = CanUpgrade();
    node.count = node.isActive ? 1 : 0;
});
```

âŒ **ä¸æ¨è**ï¼šåœ¨å¤„ç†å™¨ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
```csharp
registry.RegisterHandler(RedDotDefine.Hero_Upgradeable, node =>
{
    // é¿å…è€—æ—¶æ“ä½œ
    LoadHeroDataFromServer(); // ä¸è¦è¿™æ ·åš
    ComplexCalculation();     // é¿å…å¤æ‚è®¡ç®—
});
```

### 5. å‘½åè§„èŒƒ

âœ… **æ¨è**ï¼šæ¸…æ™°çš„æšä¸¾å‘½å
```csharp
HeroRoot                    // è‹±é›„ç³»ç»Ÿæ ¹èŠ‚ç‚¹
Hero_AnyUpgradeable        // è‹±é›„ä»»æ„å¯å‡çº§
Hero_CardUpgradeable       // è‹±é›„å¡ç‰‡å¯å‡çº§
Hero_CardUpgradeable_1     // è‹±é›„1çš„å¡ç‰‡å¯å‡çº§
```

âŒ **ä¸æ¨è**ï¼šæ¨¡ç³Šçš„å‘½å
```csharp
Hero1          // ä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆæ„æ€
HeroRed        // å¤ªæ¨¡ç³Š
Hero_Red       // ä¸å¤Ÿå…·ä½“
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ”¯æŒå¤šå…¥å£çº¢ç‚¹ï¼Ÿ

A: ä½¿ç”¨ `RegisterNodeWithMultipleParents()` æ–¹æ³•ï¼š

```csharp
var nodeKey = RedDotKey.Of(RedDotDefine.Task_Daily);
var parents = new RedDotKey[]
{
    RedDotKey.Of(RedDotDefine.MainViewRoot),
    RedDotKey.Of(RedDotDefine.TaskPanel)
};
registry.RegisterNodeWithMultipleParents(nodeKey, parents);
```

### Q2: å¦‚ä½•å®ç°åŠ¨æ€çº¢ç‚¹ï¼ˆå¦‚æ–°è·å¾—çš„è‹±é›„ï¼‰ï¼Ÿ

A: åœ¨ `OnStart()` ä¸­è®¢é˜…äº‹ä»¶ï¼Œåœ¨å›è°ƒä¸­æ³¨å†ŒèŠ‚ç‚¹ï¼š

```csharp
public void OnStart(RedDotRegistry registry)
{
    PlayerData.OnHeroAdded += heroId =>
    {
        var childKey = RedDotKey.Of(RedDotDefine.Hero_CardUpgradeable, heroId);
        registry.RegisterNode(childKey, parentKey);
        registry.RegisterHandler(childKey, node => { ... });
        RedDotManager.Instance.RefreshRedDot(childKey);
    };
}
```

### Q3: è·å¾—ææ–™åå¦‚ä½•åˆ·æ–°æ‰€æœ‰è‹±é›„çº¢ç‚¹ï¼Ÿ

A: ä½¿ç”¨æ‰¹é‡æ ‡è®°æ–¹æ³•ï¼š

```csharp
// æ ‡è®°æ‰€æœ‰è‹±é›„å¡ç‰‡ä¸ºè„
var dirtyNodes = RedDotManager.Instance.MarkSameTypeAsDirty(RedDotDefine.Hero_CardUpgradeable);

// åªåˆ·æ–°å¯è§çš„è‹±é›„
var visibleNodes = dirtyNodes.Where(node => IsVisible(node.id1)).ToList();
RedDotManager.Instance.RefreshRedDots(visibleNodes);
```

### Q4: å¦‚ä½•ç¡®ä¿çˆ¶èŠ‚ç‚¹åœ¨å­ç•Œé¢æœªæ‰“å¼€æ—¶ä¹Ÿèƒ½æ˜¾ç¤ºçº¢ç‚¹ï¼Ÿ

A: åœ¨ `RegisterRedDots()` ä¸­é¢„æ³¨å†Œæ‰€æœ‰èŠ‚ç‚¹å’Œå¤„ç†å™¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—çˆ¶èŠ‚ç‚¹çŠ¶æ€ã€‚

### Q5: åˆ‡å·æ—¶çº¢ç‚¹ç³»ç»Ÿå¦‚ä½•å¤„ç†ï¼Ÿ

A: ç³»ç»Ÿå·²è‡ªåŠ¨å¤„ç†ï¼š
- `Reloading()` æ—¶è°ƒç”¨ `RedDotManager.Instance.Cleanup()` - æ¸…ç†æ‰€æœ‰æ•°æ®
- ç™»å½•æˆåŠŸåç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°åˆå§‹åŒ– - é‡å»ºæ‰€æœ‰çº¢ç‚¹æ ‘

### Q6: å¦‚ä½•è°ƒè¯•çº¢ç‚¹ç³»ç»Ÿï¼Ÿ

A: ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š
```csharp
// æ£€æŸ¥çº¢ç‚¹æ•°æ®æ˜¯å¦å¯ç”¨
bool isAvailable = RedDotManager.Instance.CheckRedDotDataIsAvailable(key);

// è·å–çº¢ç‚¹çŠ¶æ€
bool isActive = RedDotManager.Instance.GetRedDotStatus(key);

// æ‰‹åŠ¨åˆ·æ–°
RedDotManager.Instance.RefreshRedDot(key);
```

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)

- âœ… æ¨¡å—åŒ–æ³¨å†Œæœºåˆ¶
- âœ… é¢„æ³¨å†Œæ”¯æŒ
- âœ… åŠ¨æ€çº¢ç‚¹æ³¨å†Œ
- âœ… æ‰¹é‡åˆ·æ–°æœºåˆ¶
- âœ… å¤šå…¥å£çº¢ç‚¹æ”¯æŒ
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼å’Œå‘½åè§„èŒƒ
2. æ¯ä¸ªç³»ç»Ÿç‹¬ç«‹å®ç°è‡ªå·±çš„ `IRedDotRegistrar`
3. åœ¨ `OnStart()` ä¸­ç»Ÿä¸€ç®¡ç†äº‹ä»¶è®¢é˜…
4. ä½¿ç”¨æ‰¹é‡åˆ·æ–°ä¼˜åŒ–æ€§èƒ½
5. æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»çº¢ç‚¹ç³»ç»Ÿç»´æŠ¤å›¢é˜Ÿã€‚

