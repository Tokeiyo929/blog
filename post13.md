---
title: 华佗热更项目总结
category: [代码解析]
date: 2025-12-03
cover_image: https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&w=1170&q=80
excerpt: 本文讨论了 prefab 中特效的处理方式，旨在解决特效嵌入 prefab 导致的资源卸载困难和纹理资源冗余问题，同时统一制作方式并减少程序接入。
tags: [美术, 程序]
---


华佗热更项目总结:


本文讨论了华佗热更项目的总结，涵盖构建与打包流程、更新流程、项目中遇到的问题及后续优化方向。关键要点包括：​


1. 构建与打包流程：不使用其他项目环境，从安装 package 包开始构建；生成补充元数据的 dll 和避免代码裁剪的 link；拷贝热更代码到指定目录；分别打包登录场景、测试资源、场景、预设和代码；生成资源列表和版本号，复制热更代码到自动上传 cdn 的目录；每次打包 apk 都执行相关步骤；进行华佗界面设置。​

1. 更新流程：解压安装包资源，包括比对和同步资源列表；更新服务器资源，包括比对和同步更新资源列表；加载程序集.bytes 资源，添加 AOT 泛型补充元数据和热更程序集。​
1. 项目踩坑经验：除华佗插件和设置外，其他不提交到 svn；将 “Assets/Hybrid/HybridCLRData/Generated/AOTGenericReferences.cs” 里列出的 dll 全部加入设置；涉及热更代码的资源只能 ab 加载；使用工具查看 dll 依赖并调整加载顺序。​
1. 后续优化方向：使用 BestHttp 插件进行下载优化；统一资源打包和热更打包流程；完善代码拆分工具；在性能要求高的地方使用完全泛型替代补充元数据的方法。 ​

# 1.构建,打包流程​


## 1.1.不要使用别的项目环境(平台不一样，需要的环境不一样)，从安装package包后开始一步一步构建。​
![飞书文档 - 图片](https://i.postimg.cc/W33P9vY7/飞书文档_图片_1765244300.png)

## 1.2.生成为AOT泛型补充元数据的dll以及避免代码裁剪的link​
![飞书文档 - 图片](https://i.postimg.cc/266fHD9T/飞书文档_图片_1765244301.png)

## 1.3.生成热更代码并拷贝到 StreamingAssets目录下(同时拷贝的还有第2步中补充aot元数据的dll)，​


![飞书文档 - 图片](https://i.postimg.cc/L824zrSC/720X720.png)



## 1.4.打包登录场景(第一次必须打ab，后面可以有修改才打，重复打也没影响，有缓存增量打包所以也很快，测试场景和登录场景在一个ab里面后面可以去掉测试场景），打包测试资源(有修改就打包，没有就不用)​

分别打包场景，预设，代码​
​![飞书文档 - 图片](https://i.postimg.cc/gJJPMWtg/飞书文档_图片_1765244305.png)

## 1.5.生成资源列表和版本号(比对SHA256码，更新版本号)，复制热更代码到自动上传cdn的目录​
![飞书文档 - 图片](https://i.postimg.cc/L824zrSC/720X720.png)



## 1.6.打包：2，3，4，5，每次打包apk都做一次。(可以使用这里的菜单一键执行)​
![飞书文档 - 图片](https://i.postimg.cc/1ttZWQ7W/飞书文档_图片_1765244308.png)




## 1.7.华佗界面设置:


### 1.7.1 .热更代码设置​
![飞书文档 - 图片](https://i.postimg.cc/yddzfHpQ/飞书文档_图片_1765244310.png)

### 1.7.2.步骤1.2中用到的路径​
![飞书文档 - 图片](https://i.postimg.cc/htc49HnY/ddd160d0_d426_4596_98de_69663cdfafa6.png)



### 1.7.3.步骤1.3要复制的内容​

内容来源Assets/Hybrid/HybridCLRData/Generated/AOTGenericReferences.cs这里面列出来dll​
官方文档:https://hybridclr.doc.code-philosophy.com/docs/beginner/generic#%E8%8E%B7%E5%BE%97%E8%A1%A5%E5%85%85%E5%85%83%E6%95%B0%E6%8D%AEdll​


![飞书文档 - 图片](https://i.postimg.cc/k44djmYL/飞书文档_图片_1765244313.png)
### 1.7.4.步骤1.1中的输出路径​
![飞书文档 - 图片](https://i.postimg.cc/gJJPMWB9/飞书文档_图片_1765244316.png)

### 1.7.5.步骤1.2的缓存路径​
![飞书文档 - 图片](https://i.postimg.cc/L824zrSb/fc607be0_712c_4925_83f2_815668f16c71.png)

![飞书文档 - 图片](https://i.postimg.cc/gkvkLGCQ/cb795a3a_6d8c_4535_9696_9199c6dc6e83.png)

# 2.更新流程​
![飞书文档 - 图片](https://i.postimg.cc/0QQqtsHR/飞书文档_图片_1765244320.png)

## 2.1.解压安装包资源​

2.1.1.比对本地“默认资源列表“与安装包中的“默认资源列表“，​
2.1.2.决定是否解压安装包中默认资源​
2.1.3.同步“默认资源列表”​
2.1.4.同步本地“默认资源列表“到本地“更新资源列表“。​

## 2.2.更新服务器资源​

2.2.1.比对本地“更新资源列表“与服务器“更新资源列表“​
2.2.2.决定是否下载服务器更新资源​
2.2.3.同步“更新资源列表”​

## 2.3.加载程序集.bytes资源​


## 2.4.添加AOT泛型的补充元数据​


## 2.55.添加热更程序集​


# 3.走过坑:


## 3.1.直接拿示例代码的环境提交到了svn.​

mac机与window要的环境不一样，结论除了华佗插件和设置，其它都不用提交到svn​

## 3.2.泛型缺失.​

在1.7.3的设置中只放了常用的AOT的补充元数据的dll,有泛型缺失，结论“Assets/Hybrid/HybridCLRData/Generated/AOTGenericReferences.cs“这里面列出来dll，全部都加进去​

## 3.3.场景没走ab.​



项目有生成场景ab，但是没去掉buildsetting的勾选，场景可能不是从ab中加载的，也就没应用到热更代码。结论涉及热更代码的资源，只能ab加载。​

## 3.4.多个热更dll之间有依赖关系.​

使用工具（[MenuItem("Build/Check DLL Dependencies")]查看dll依赖,然后调整dll的加载顺序。​

# 4.后续可以继续的优化​


## 4.1.下载优化：使用BestHttp插件，多线程/多协程，断点续传​


## 4.2.统一以前的资源打包和现在的热更打包,完善项目的打包，加载流程​


## 4.3.完善代码拆分工具​


## 4.5.对于性能要求高得地方可以使用完全泛型替代给AOT的补充元数据的方法​

官方文档:https://hybridclr.doc.code-philosophy.com/docs/basic/aotgeneric​
例子：在非热更代码中，主动调用一次泛型，就可以不用补充元数据了​
![飞书文档 - 图片](https://i.postimg.cc/Pxxk6jVc/飞书文档_图片_1765244325.png)
